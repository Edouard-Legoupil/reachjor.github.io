<!DOCTYPE html>
<html>
<head>
     <!-- Load Leaflet from CDN-->
    <link rel="stylesheet" href="leaflet/leaflet.css" />
    <script src="leaflet/leaflet-src.js"></script>
	
	<link rel="stylesheet" href="css/leaflet.label.css" />
	<script src="js/leaflet.label.js"></script>
	
	<script src="js/leaflet.groupedlayercontrol.js"></script>
	<link rel="stylesheet" href="css/leaflet.groupedlayercontrol.css" />
	
	<!-- <script src="js/leaflet.label.js"></script> -->

	<script src="js/leaflet.ajax.min.js"></script>
	<link rel="stylesheet" type="text/css" href="css/style.css">
	
	<script type="text/javascript"  src="js/esri-leaflet.js"></script>
	<script src="js/jquery-1.11.1.js"></script>
	
	<script type="text/javascript" src="js/RRM_RCA_area_intervention.js"></script>
	<script type="text/javascript" src="js/RRM_RCA_admin1.js"></script>
	
    <style>
	
		.map {
		height: 500px;
		}
    </style>
	
</head>

<body>

    <div id="map"></div>

<script>
		
	var LeafIcon = L.Icon.extend({
				options: {
					iconSize:     [25, 25],
					iconAnchor:   [0, 0],
					}
			});
			
	var LeafIconMSA = L.Icon.extend({
				options: {
					iconSize:     [20, 25],
					iconAnchor:   [0, 0],
					}
			});
		
	var symb_choc = new LeafIcon({iconUrl: 'image/choc.png'});
	var symb_dist = new LeafIcon({iconUrl: 'image/distrib.png'});
	var symb_msa = new LeafIconMSA({iconUrl: 'image/MSA.png'});
	var symb_mex = new LeafIconMSA({iconUrl: 'image/MEx.png'});
	var map = L.map('map').setView([6.6,19.90], 7);
	
	function popUp(feature, layer) {
		layer.bindPopup(feature.properties.activityName+": "+feature.properties.locationName+': '+feature.properties.startDate+' - '+feature.properties.partnerName);
	  }
  
	var base = L.tileLayer('http://otile2.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
		}).addTo(map);
		
	sat="http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}";
	var satt = new L.TileLayer(sat);
	var topo = L.esri.basemapLayer("Topographic");
	var natgeo = L.esri.basemapLayer("NationalGeographic");
	var ocean = L.esri.basemapLayer("Oceans");
	var shade = L.esri.basemapLayer("ShadedRelief");
	var grey = L.esri.basemapLayer("DarkGray");
		
	var MSA = new L.geoJson.ajax("http://build140.activityinfoeu.appspot.com/resources/sites/points?activity=16230",
	{
	dataType:"json",
	pointToLayer: function (feature, latlng) {
			return L.marker(latlng, {
			   icon: symb_msa,
			   opacity:0.9
			});
		},
	onEachFeature:popUp
	});
	
	var inter = new L.geoJson.ajax("http://build140.activityinfoeu.appspot.com/resources/sites/points?activity=13327",
	{
	dataType:"json",
	pointToLayer: function (feature, latlng) {
			return L.marker(latlng, {
			   icon: symb_dist,
			   opacity:0.9
			});
		},
	onEachFeature:popUp
	});
	
	var mex = new L.geoJson.ajax("http://build140.activityinfoeu.appspot.com/resources/sites/points?activity=16227",
	{
	dataType:"json",
	pointToLayer: function (feature, latlng) {
			return L.marker(latlng, {
			   icon: symb_mex,
			   opacity:0.9
			});
		},
	onEachFeature:popUp
	});

	var alerte = new L.geoJson.ajax("http://build140.activityinfoeu.appspot.com/resources/sites/points?activity=16228",
	{
	dataType:"json",
	pointToLayer: function (feature, latlng) {
			return L.marker(latlng, {
			   icon: symb_choc,
			   opacity:0.9
			});
		},
	onEachFeature:popUp
	 });
	 	
	function getColor(d) {
			return d == "ACF"  ? '#0467b5' :
			       d == "ACTED"  ? '#0f3a63' :
			       d == "DRC"  ? '#ecff5c' :
    			   d == "IRC"  ? '#868478' :
				   d == "PU AMI"  ? '#53a653' :
				   d == "SOLIDARITES" ? '#b31b16' :
									'#FFEDA0';
		}
	
	function style(feature) {
		return {
			weight:1,
			opacity: 0.9,
			color: 'black',
			dashArray: '3',
			fillOpacity: 0,
			//fillColor: getColor(feature.properties.food_insec)
			};
	}
	
	function couverture(feature) {
		return {
			weight:0,
			opacity: 0.9,
			color: 'white',
			dashArray: '3',
			fillOpacity: 0.3,
			fillColor: getColor(feature.properties.PREF_NOM)
			};
	}
	
	var  area_ngo = L.geoJson(area, {
			style: couverture,
			//onEachFeature:
	});

	
	var legend1 = L.control({position: 'bottomleft'});
		legend1.onAdd = function (map) {

			var div = L.DomUtil.create('div', 'info legend'),
				grades = ["ACF","ACTED","DRC","IRC","PU AMI","SOLIDARITES"],
				labels = [],
				from, to;
			for (var i = 0; i < 6; i++) {
				from = grades[i];
				//to = grades[i];
				labels.push(
					'<i style="background:' + getColor(from) + '"></i> ' + from);
			}
			div.innerHTML = labels.join('<br>');
			return div;
		};
		
	//legend1.addTo(map)	
		
	var  prefectures = L.geoJson(pref, {
			style: style,
			//onEachFeature:
	}).addTo(map);
	
	   var baseMaps = {
           "Basemap":base,
		"Image Sattelite":satt,
		"NationalGeographic":natgeo,
		"Topographique":topo,
		"Frontiere":grey		
        };
		
		var groupedOverlays = {
		  "Admistrative": {
			"Prefectures":prefectures	   
		  },
		  "Chocs": {
			"Incident reportes":alerte
		 },
		  "RRM RCA": {
		   "Couverture ONG":area_ngo,
			"Mission exploratoire":mex,
			"MSA":MSA,
			"Intervention RRM":inter	
		  }
		};



layersControl = L.control.groupedLayers(baseMaps, groupedOverlays);
map.addControl(layersControl);
	
	
map.on('overlayadd', function (eventLayer) {
    // Switch to the Permafrost legend...
    if (eventLayer.name === 'Couverture ONG') {
        //map.addControl(legend1);
        legend1.addTo(map);
		//info.addTo(map);
    }
	else if (eventLayer.name === 'ITS') {
        //map.addControl(legend1);
        //infoITS.addTo(map);
		//legend_ITS_v2.addTo(map);
    } 
});

map.on('overlayremove', function (eventLayer) {
    // Switch to the Permafrost legend...
    if (eventLayer.name === 'Couverture ONG') {
        map.removeControl(legend1);
        //map.removeControl(info);
        //legend1.addTo(map);
    }
    else if (eventLayer.name === 'ITS') {
        //map.removeControl(infoITS);
		//map.removeControl(legend_ITS_v2);
        //legend1.addTo(map);
    }	
});
        //map.addControl(layersControl);
	
	
	
</script>
</body>
</html>
